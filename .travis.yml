sudo: required
language: php

php:
  - '7.4'

matrix:
  fast_finish: true
  # allow_failures:
  #   - php: 7.4
  #   - env: WP_VERSION=5.6

services:
  - mysql

cache:
  apt: true
  directories:
    - vendor
    - $HOME/.composer/cache/files
addons:
  apt:
    packages:
      # required by WordPress
      - libjpeg-dev
      - libpng-dev
      
      # - nginx
  # hosts:
  #   - wp.localhost
  #   - test1.wp.localhost
  #   - test2.wp.localhost

# env:
#   global:
#     - WP_FOLDER="/tmp/wordpress"
#     - WP_URL="http://wp.localhost"
#     - WP_DOMAIN="wp.localhost"
#     - DB_NAME="test"
#     - TEST_DB_NAME="wploader"
#     - WP_TABLE_PREFIX="wp_"
#     - WP_ADMIN_USERNAME="admin"
#     - WP_ADMIN_PASSWORD="admin"
#     - WP_SUBDOMAIN_1="test1"
#     - WP_SUBDOMAIN_1_TITLE="Test Subdomain 1"
#     - WP_SUBDOMAIN_2="test2"
#     - WP_SUBDOMAIN_2_TITLE="Test Subdomain 2"
#   matrix:
#     - WP_VERSION=latest
#     - WP_VERSION=nightly

before_install:
  # create the databases that will be used in the tests
  - mysql -e "create database IF NOT EXISTS $DB_NAME;" -uroot
  - mysql -e "create database IF NOT EXISTS $TEST_DB_NAME;" -uroot
  # set up folders
  - mkdir -p $WP_FOLDER
  - mkdir tools
  # install wp-cli in the `tools` folder
  - wget https://raw.githubusercontent.com/wp-cli/builds/gh-pages/phar/wp-cli.phar -P $(pwd)/tools/
  - chmod +x tools/wp-cli.phar && mv tools/wp-cli.phar tools/wp
  # append the `tools` folder to the PATH
  - export PATH=$PATH:$(pwd)/tools
  # prepend the `vendor/bin` folder the PATH
  - export PATH=vendor/bin:$PATH

install:
  - composer install --prefer-dist

  

before_script:
  - sudo service php7-fpm restart
  - sudo service apache2 restart

  # symbolically link the plugin root folder to the WordPress installation folder
  # if you are using wp-browser use the Symlinker extension and skip this
  - ln -s $TRAVIS_BUILD_DIR $WP_FOLDER/wp-content/plugins

  # build Codeception modules
  - codecept build

script:
  - codecept run acceptance
  - codecept run functional
  - codecept run integration
  - codecept run unit
